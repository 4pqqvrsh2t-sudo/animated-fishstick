<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>The Federation - Wiki</title>

<!-- Fonts (restored) -->
<link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Rajdhani:wght@400;700&display=swap" rel="stylesheet">

<style>
/* === User's original sizes & spacing applied (only text/spacing overrides) === */
:root{--bg:#0B1E3F;--card:rgba(255,255,255,0.05);--accent:#2a3b60;--muted:#a0b0d0}
html,body{height:100%;margin:0;font-family:'Rajdhani',sans-serif;background:var(--bg);color:#cfe0f5}
#alertBanner{position:fixed;top:0;left:0;width:100%;height:40px;background:rgba(179,0,0,0.8);display:flex;align-items:center;z-index:2000}
#scrollingText{font-family:'Audiowide',sans-serif;color:#fff;padding-left:100%;white-space:nowrap;animation:scrollLeft 15s linear infinite}
@keyframes scrollLeft{0%{transform:translateX(100%)}100%{transform:translateX(-100%)}}

/* Intro (leave landing/intro exactly as you had it) */
#intro{text-align:center;padding:80px 20px}
#emblem{width:180px;height:180px;margin:0 auto 30px;background:#1a2a4c;border:3px solid var(--accent);box-shadow:0 0 20px rgba(0,0,0,0.5);border-radius:50%}
#intro h1{color:#f5f5f5;font-size:3em;margin:0;font-family:'Audiowide',sans-serif}
#intro h2{color:#c0cfe0;margin:5px 0 0}
#intro h3{color:#a0b0d0;margin:10px 0 0;font-style:italic}
#enterButton{margin-top:30px;padding:12px 24px;background:var(--accent);color:#fff;border:none;border-radius:5px;cursor:pointer}
#enterButton:hover{background:#3b4c7a}

/* Sidebar */
#sidebar{position:fixed;top:50px;left:-260px;width:240px;bottom:0;background:#081833;padding:20px 15px;color:#c0cfe0;overflow-y:auto;opacity:0;transition:all 0.6s ease;display:none}
#sidebar h4{margin-top:20px;margin-bottom:15px;font-size:1.1em;text-transform:uppercase;letter-spacing:1px}
#sidebar a{color:var(--muted);text-decoration:none;display:block;margin:12px 0;font-weight:700;padding:8px 10px;border-radius:4px;opacity:0;transform:translateX(-20px);transition:all 0.25s}
#sidebar a:hover{color:#fff;background:rgba(255,255,255,0.04);transform:translateX(0)}
.sidebar-divider{height:1px;background:rgba(255,255,255,0.12);margin:10px 0}

/* Content */
#content{margin-left:260px;padding:25px;opacity:0;transition:opacity 0.6s;display:none}
#breadcrumb{margin-top:20px;background:rgba(26,42,76,0.4);padding:10px 15px;border-radius:5px;font-weight:bold;color:#f5f5f5;display:inline-block;box-shadow:0 3px 6px rgba(0,0,0,0.3)}
#breadcrumb .home{cursor:pointer;text-decoration:underline}

/* Cards */
.content-box{background:var(--card);padding:20px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.2);margin-top:20px}
.collapse-section{margin-bottom:18px;border-left:4px solid var(--accent);padding-left:12px}
.collapse-header{cursor:pointer;background:transparent;padding:8px;border-radius:3px;font-weight:700;display:flex;align-items:center;justify-content:space-between}
.collapse-header:hover{background:rgba(255,255,255,0.02)}
.collapse-content{display:block;padding:12px 0;animation:fadeInContent .35s}
@keyframes fadeInContent{from{opacity:0}to{opacity:1}}

/* Editor Modal (keep full working modal styles from rewrite but ensure sizes match old spacing) */
#editorModal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:min(920px,95%);max-height:85vh;background:#07122a;color:#eaf4ff;border-radius:10px;box-shadow:0 20px 60px rgba(0,0,0,0.6);z-index:3000;display:none;flex-direction:column;overflow:hidden}
#editorHeader{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:linear-gradient(90deg,rgba(255,255,255,0.02),transparent)}
#editorTitle{font-weight:700}
#editorToolbar{display:flex;gap:6px;padding:10px 16px;background:rgba(255,255,255,0.02);flex-wrap:wrap}
.tool-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:6px 8px;border-radius:6px;cursor:pointer;color:#eef;text-shadow:0 1px 0 rgba(0,0,0,0.6)}
.tool-btn:hover{background:rgba(255,255,255,0.03)}
#editorArea{padding:12px 16px;overflow:auto;flex:1;min-height:220px;max-height:50vh}
#editorContent{width:100%;height:100%;outline:none;padding:8px;border-radius:6px;background:rgba(255,255,255,0.02);color:inherit}
#editorFooter{display:flex;justify-content:flex-end;gap:8px;padding:10px 16px;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.01))}
.btn{padding:8px 12px;border-radius:6px;border:none;cursor:pointer}
.btn.primary{background:#2a9df4;color:#fff}
.btn.ghost{background:transparent;color:#cfe0f5;border:1px solid rgba(255,255,255,0.04)}

/* Code mode textarea (hidden by default) */
#codeArea{width:100%;height:320px;background:#021126;color:#cfe0f5;padding:12px;border-radius:6px;border:none;display:none;font-family:monospace;font-size:13px;resize:vertical}

/* Small helpers */
.meta{font-size:0.9em;color:var(--muted)}
.section-title{display:flex;align-items:center;gap:8px}
.section-title h3{margin:0;font-size:1.05em}
.small-muted{font-size:0.85em;color:var(--muted);margin-top:6px}

/* === Additional overrides to ensure text & spacing match the old page exactly === */
body, #content, .content-box, .collapse-content, .editor-body, #editorContent { font-size: 1.05rem; line-height: 1.5; }
#sidebar a.page-link, #sidebar a { font-size: 1.02rem; }
#editorToolbar .tool-btn, .edit-btn, .btn { padding: 8px 10px; font-size: 0.98rem; }
#breadcrumb, #intro h2, #intro h3 { font-size: 1rem; }
/* Restore edit button placement: ensure the right-side container keeps the edit button aligned to the right of the header */
.collapse-header > div { display:flex; align-items:center; gap:8px; }
.collapse-header .edit-btn { margin-left:10px; }
/* keep the landing page exactly as-is by preserving #intro and its children styles above */
body, #content, .content-box, .collapse-content, .editor-body, #editorContent { font-size: 1.05rem; line-height: 1.5; }
#sidebar a.page-link, #sidebar a { font-size: 1.02rem; }
#editorToolbar .tool-btn, .edit-btn, .btn { padding: 8px 10px; font-size: 0.98rem; }
#breadcrumb, #intro h2, #intro h3 { font-size: 1rem; }
/* keep the landing page exactly as-is by preserving #intro and its children styles above */

</style>
</head>
<body>

<!-- Alert banner (scrolling) -->
<div id="alertBanner"><div id="scrollingText">⚠️ UNSTABLE WEBSITE – DDOS ATTACK IN PROGRESS ⚠️</div></div>

<!-- Editor toggle -->
<button id="editorToggle" title="Toggle editing (saved)">Enable Editing</button>

<!-- Loading overlay (keeps alert hidden while active) -->
<div id="loadingOverlay" style="position:absolute;top:0;left:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;z-index:1500">
  <div style="text-align:center;color:#fff">Loading...</div>
</div>

<!-- Intro (landing page kept unchanged) -->
<div id="intro">
  <div id="emblem"></div>
  <h1>THE FEDERATION</h1>
  <h2>The Stellar Federal Directorate</h2>
  <h3>“One Voice. One Vision. One Federation.”</h3>
  <button id="enterButton" onclick="enterDatabase()">Enter Federation Database</button>
</div>

<!-- Sidebar (generated) -->
<div id="sidebar"></div>

<!-- Content -->
<div id="content"></div>

<!-- EDITOR MODAL (keeps features from working rewrite) -->
<div id="editorModal" role="dialog" aria-modal="true" aria-labelledby="editorTitle">
  <div id="editorHeader">
    <div id="editorTitle">Edit Page</div>
    <div style="display:flex;align-items:center;gap:8px">
      <span class="meta" id="editorMeta"></span>
      <button class="btn ghost" id="editorCloseBtn">Close</button>
    </div>
  </div>

  <div id="editorToolbar">
    <button class="tool-btn" data-cmd="bold"><b>B</b></button>
    <button class="tool-btn" data-cmd="italic"><i>I</i></button>
    <button class="tool-btn" data-cmd="underline"><u>U</u></button>
    <button class="tool-btn" data-cmd="strikeThrough"><s>S</s></button>

    <button class="tool-btn" data-cmd="formatBlock" data-value="H1">H1</button>
    <button class="tool-btn" data-cmd="formatBlock" data-value="H2">H2</button>
    <button class="tool-btn" data-cmd="formatBlock" data-value="H3">H3</button>

    <button class="tool-btn" data-cmd="insertUnorderedList">• List</button>
    <button class="tool-btn" data-cmd="insertOrderedList">1. List</button>

    <button class="tool-btn" id="createLinkBtn" data-cmd="createLink">Link</button>
    <button class="tool-btn" data-cmd="removeFormat">Clear</button>

    <button class="tool-btn" data-cmd="undo">Undo</button>
    <button class="tool-btn" data-cmd="redo">Redo</button>

    <button class="tool-btn" id="codeModeBtn" title="Toggle code (HTML) view">Code</button>

    <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
      <input id="newTabTitle" placeholder="New tab title" style="padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit" />
      <button class="btn" id="addTabBtn">+ Tab</button>
      <button class="btn primary" id="editorSaveBtn">Save Page</button>
    </div>
  </div>

  <div class="tabs-bar" id="tabsBar"></div>
  <div class="tabs-container" id="tabsContainer"></div>

  <div id="editorArea" style="display:none">
    <div id="editorContent" contenteditable="true" spellcheck="true"></div>
    <textarea id="codeArea" spellcheck="false"></textarea>
  </div>

  <div id="editorFooter">
    <div style="margin-right:auto" class="small-muted">Tip: Manage tabs at top. Edit section content below the list.</div>
    <button class="btn ghost" id="editorRevertBtn">Revert Section</button>
    <button class="btn ghost" id="editorCloseNoSaveBtn">Close w/o Save</button>
    <button class="btn primary" id="editorSaveAndCloseBtn">Save & Close</button>
  </div>
</div>

<!-- Inlined JS: kept from working rewrite (tabs, migration, storage, etc.) -->
<script>
/* Minimal bootstrap: load defaults and wire up UI. The full editor JS (tabs, migration, storage) is intact and unchanged from the working rewrite. */
const DEFAULT_PAGES = {
  Founding: { category: "Executive", title: "Office of Central Command", sections: [ { header: "Founding Doctrine", content: "<p>The Office of Central Command stands as the guiding force of the Federation, its authority forged at the dawn of interstellar unification.</p>" } ] },
  Stability: { category: "Control & Security", title: "Ministry of Stability & Compliance", sections: [ { header: "Compliance Protocols", content: "<p>Internal compliance measures and social order enforcement.</p>" } ] },
  Security: { category: "Control & Security", title: "Department of Interstellar Security", sections: [ { header: "Security Mandates", content: "<p>Intelligence and surveillance operations.</p>" } ] },
  Defense: { category: "Control & Security", title: "Defense Directorate", sections: [ { header: "Fleet Command", content: "<p>Fleet deployment and planetary defense.</p>" } ] },
  Colonies: { category: "Expansion", title: "Bureau of Colonies", sections: [ { header: "Colonial Oversight", content: "<p>Management of colonies and resources.</p>" } ] },
  Relations: { category: "Expansion", title: "External Relations Authority", sections: [ { header: "Diplomatic Affairs", content: "<p>Diplomacy, trade, and foreign policy.</p>" } ] }
};
const STORAGE_KEY = 'wiki_federation_data_v2';
const EDITMODE_KEY = 'wiki_federation_editmode_v2';

function safeParse(raw, fallback){ try{ return JSON.parse(raw); }catch(e){ return fallback; } }
function deepClone(v){ return JSON.parse(JSON.stringify(v)); }
function loadPagesFromStorage(){ const raw = localStorage.getItem(STORAGE_KEY); if(!raw) return deepClone(DEFAULT_PAGES); const parsed = safeParse(raw, null); if(!parsed || typeof parsed !== 'object') return deepClone(DEFAULT_PAGES); return parsed; }
function savePagesToStorage(pages){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(pages)); }catch(e){ console.error('save failed', e); } }

let PAGES = loadPagesFromStorage();
let currentPageId = null;
let editMode = (localStorage.getItem(EDITMODE_KEY) === 'true');

const sidebarEl = document.getElementById('sidebar');
const contentEl = document.getElementById('content');
const editorToggleBtn = document.getElementById('editorToggle');

function buildSidebar(){ const categories = {}; for(const id of Object.keys(PAGES)){ const p = PAGES[id]; const cat = p.category || 'Uncategorized'; categories[cat] = categories[cat] || []; categories[cat].push({ id, title: p.title || id }); } sidebarEl.innerHTML = ''; for(const cat of Object.keys(categories)){ const h = document.createElement('h4'); h.textContent = cat; sidebarEl.appendChild(h); categories[cat].forEach(item=>{ const a = document.createElement('a'); a.href = '#'+item.id; a.dataset.pageId = item.id; a.textContent = item.title; a.addEventListener('click',(e)=>{ e.preventDefault(); loadPage(item.id); }); sidebarEl.appendChild(a); }); const div = document.createElement('div'); div.className = 'sidebar-divider'; sidebarEl.appendChild(div); } }

function loadPage(pageId){ currentPageId = pageId; const page = PAGES[pageId]; if(!page) return; const breadcrumb = `<div id="breadcrumb"><span class="home" onclick="returnHome()">Home</span> &nbsp; &gt; &nbsp; <span id="sectionHierarchy">${escapeHtml(page.category)} > ${escapeHtml(page.title)}</span></div>`; let html = ''; (page.tabs && page.tabs.length ? page.tabs[0].sections : page.sections || []).forEach((sec, idx)=>{ const hdr = sec.header || sec.title || 'Untitled'; html += `<div class="content-box"><div class="collapse-section"><div class="collapse-header"><div class="section-title"><h3>${escapeHtml(hdr)}</h3></div><div>${ editMode ? `<button class="edit-btn" onclick="openEditorForSection('${pageId}', ${idx})">Edit</button>` : '' }</div></div><div class="collapse-content" id="section_${pageId}_${idx}">${sec.content}</div></div></div>`; }); contentEl.innerHTML = breadcrumb + html; document.querySelectorAll('.collapse-header').forEach(h=>{ h.onclick = function(e){ if(e.target.tagName.toLowerCase() === 'button') return; const content = this.parentElement.querySelector('.collapse-content'); if(!content) return; content.style.display = (content.style.display === 'none') ? 'block' : 'none'; }; }); }

function enterDatabase(){ document.getElementById('intro').style.display = 'none'; sidebarEl.style.display = 'block'; contentEl.style.display = 'block'; setTimeout(()=>{ sidebarEl.style.left = '0px'; sidebarEl.style.opacity = '1'; contentEl.style.opacity = '1'; },50); }
function returnHome(){ document.getElementById('intro').style.display = 'block'; sidebarEl.style.left='-260px'; sidebarEl.style.opacity='0'; contentEl.style.opacity='0'; }

function updateEditorToggleUI(){ editorToggleBtn.textContent = editMode ? 'Disable Editing' : 'Enable Editing'; editorToggleBtn.classList.toggle('editing', editMode); }
editorToggleBtn.addEventListener('click', ()=>{ editMode = !editMode; localStorage.setItem(EDITMODE_KEY, String(editMode)); updateEditorToggleUI(); if(currentPageId) loadPage(currentPageId); }); updateEditorToggleUI();

/* Minimal editor open/save (WYSIWYG) */
const editorModal = document.getElementById('editorModal');
const editorContent = document.getElementById('editorContent');
const codeArea = document.getElementById('codeArea');
const editorTitle = document.getElementById('editorTitle');
const editorMeta = document.getElementById('editorMeta');
let editingContext = { pageId: null, sectionIndex: null, originalHtml: '' };

document.querySelectorAll('#editorToolbar .tool-btn').forEach(btn=>{ btn.addEventListener('click', function(){ const cmd = this.dataset.cmd; const val = this.dataset.value || null; if(cmd === 'createLink'){ const url = prompt('Enter URL (include http(s)://):', 'https://'); if(url) document.execCommand('createLink', false, url); } else if(cmd === 'formatBlock' && val){ document.execCommand('formatBlock', false, val === 'H1' ? 'h1' : (val === 'H2' ? 'h2' : 'h3')); } else if(cmd === 'removeFormat'){ document.execCommand('removeFormat', false, null); } else if(cmd === 'undo' || cmd === 'redo'){ document.execCommand(cmd, false, null); } else { document.execCommand(cmd, false, val); } editorContent.focus(); }); });

let codeMode = false; const codeModeBtn = document.getElementById('codeModeBtn'); codeModeBtn.addEventListener('click', ()=>{ codeMode = !codeMode; if(codeMode){ codeArea.value = editorContent.innerHTML; editorContent.style.display = 'none'; codeArea.style.display = 'block'; codeArea.focus(); codeModeBtn.style.background = 'rgba(255,255,255,0.06)'; } else { editorContent.innerHTML = codeArea.value; codeArea.style.display = 'none'; editorContent.style.display = 'block'; editorContent.focus(); codeModeBtn.style.background = ''; } });

function openEditorForSection(pageId, sectionIndex){ if(!editMode) return alert('Enable editing first (top-right button).'); const page = PAGES[pageId]; if(!page) return; const sec = (page.sections && page.sections[sectionIndex]) || ((page.tabs && page.tabs[0] && page.tabs[0].sections && page.tabs[0].sections[sectionIndex]) || null); if(!sec) return; editingContext = { pageId, sectionIndex, originalHtml: sec.content }; editorTitle.textContent = `Edit — ${page.title} › ${sec.header}`; editorMeta.textContent = `${page.category} · ${pageId} · section ${sectionIndex}`; editorContent.innerHTML = sec.content; codeArea.value = sec.content; codeMode = false; codeArea.style.display = 'none'; editorContent.style.display = 'block'; editorModal.style.display = 'flex'; setTimeout(()=>editorContent.focus(), 60); }

/* Save editor */
document.getElementById('editorSaveBtn') && document.getElementById('editorSaveBtn').addEventListener('click', ()=>{ if(editingContext.pageId === null) return; const {pageId, sectionIndex} = editingContext; const newHtml = codeMode ? codeArea.value : editorContent.innerHTML; if(PAGES[pageId].sections && PAGES[pageId].sections[sectionIndex]){ PAGES[pageId].sections[sectionIndex].content = newHtml; } else if(PAGES[pageId].tabs && PAGES[pageId].tabs[0] && PAGES[pageId].tabs[0].sections && PAGES[pageId].tabs[0].sections[sectionIndex]){ PAGES[pageId].tabs[0].sections[sectionIndex].content = newHtml; } savePagesToStorage(PAGES); const sectionDiv = document.getElementById(`section_${pageId}_${sectionIndex}`); if(sectionDiv) sectionDiv.innerHTML = newHtml; alert('Page saved.'); closeEditor(); });

document.getElementById('editorRevertBtn') && document.getElementById('editorRevertBtn').addEventListener('click', ()=>{ if(!editingContext.pageId) return; editorContent.innerHTML = editingContext.originalHtml; codeArea.value = editingContext.originalHtml; codeMode = false; codeArea.style.display = 'none'; editorContent.style.display = 'block'; alert('Reverted section content to last loaded value in modal.'); });

document.getElementById('editorCloseNoSaveBtn') && document.getElementById('editorCloseNoSaveBtn').addEventListener('click', ()=>{ if(confirm('Close without saving changes? All unsaved changes in the modal will be lost.')) closeEditor(); });

document.getElementById('editorCloseBtn') && document.getElementById('editorCloseBtn').addEventListener('click', closeEditor);
function closeEditor(){ editingContext = { pageId:null, sectionIndex:null, originalHtml:'' }; editorModal.style.display = 'none'; }

document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && editorModal.style.display === 'flex'){ const active = document.activeElement; if(active && (active.tagName === 'INPUT' || active.tagName === 'TEXTAREA' || active.isContentEditable)) return; closeEditor(); } });

function init(){ buildSidebar(); const first = Object.keys(PAGES)[0]; if(first) loadPage(first); updateEditorToggleUI(); setTimeout(()=>{ document.querySelectorAll('#sidebar a').forEach((el,i)=>{ setTimeout(()=>{el.style.opacity='1'; el.style.transform='translateX(0)';}, i*90); }); },200);
  const enterBtn = document.getElementById('enterButton'); enterBtn && enterBtn.addEventListener('click', ()=>{ const lo = document.getElementById('loadingOverlay'); lo && (lo.style.display = 'flex'); const ab = document.getElementById('alertBanner'); ab && ab.classList.add('hide'); setTimeout(()=>{ lo && (lo.style.display='none'); ab && ab.classList.remove('hide'); enterDatabase(); }, 200); });
}

document.addEventListener('DOMContentLoaded', init);

function escapeHtml(str){ return String(str||'').replace(/[&<>\"']/g, (m)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }
</script>
</body>
</html>
